<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Anime Habit Tracker ‚Äì Hard Work Points</title>
  <style>
    * { box-sizing: border-box; font-family: Arial, sans-serif; }

    body {
      margin: 0;
      min-height: 100vh;
      background: #0f1220;
      color: #f4f4f4;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding-top: 40px;
    }

    .app { width: 100%; max-width: 900px; }
    h1, h2, h3 { margin-top: 0; text-align: center; }

    .nav { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }

    .card {
      background: #1b1f3a;
      border-radius: 14px;
      padding: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,.35);
      margin: auto;
    }

    .menu { display: none; }
    .menu.active { display: block; }

    button {
      background: #ff9f1c;
      border: none;
      border-radius: 10px;
      padding: 8px 14px;
      font-weight: bold;
      cursor: pointer;
      margin: 4px;
    }

    button:disabled { opacity: 0.5; cursor: not-allowed; }
    input { padding: 6px; border-radius: 6px; border: none; }

    .task { display: flex; justify-content: space-between; align-items: center; margin: 8px 0; }
    .done { text-decoration: line-through; opacity: 0.6; }

    .series { margin-bottom: 20px; }
    .character {
      border: 2px solid #333;
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 10px;
      cursor: pointer;
    }

    .locked { opacity: 0.4; cursor: not-allowed; }
    .selected { border-color: #ffd166; box-shadow: 0 0 15px rgba(255,209,102,0.7); }

    .xp-bar { background: #333; border-radius: 6px; overflow: hidden; height: 12px; margin-top: 6px; }
    .xp-fill { height: 100%; background: linear-gradient(90deg, red, orange, yellow, green, cyan, blue, violet); width: 0%; }

    .wheel-container { display: flex; justify-content: center; margin: 20px 0; }
    .wheel {
      width: 220px;
      height: 220px;
      border-radius: 50%;
      border: 8px solid #fff;
      background: conic-gradient(red, orange, yellow, green, cyan, blue, violet, red);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      text-align: center;
    }

    .center { text-align: center; }
  </style>
</head>
<body>

<div class="app">
  <h1>üî• Anime Habit Tracker üî•</h1>

  <div class="nav">
    <button onclick="openMenu('tasks')">Tasks</button>
    <button onclick="openMenu('characters')">Characters</button>
    <button onclick="openMenu('wheelMenu')">Wheel</button>
  </div>

  <!-- TASKS -->
  <div id="tasks" class="menu active card">
    <h2>Tasks</h2>
    <div class="center">
      <input id="taskName" placeholder="Task name" />
      <input id="taskHWP" type="number" placeholder="HWP" />
      <button onclick="addTask()">Add</button>
      <button onclick="resetTasks()">Reset Tasks</button>
    </div>
    <div id="taskList"></div>
    <hr>
    <div class="center">
      <button onclick="exportSave()">‚¨á Download Save</button>
      <input type="file" id="importFile" style="display:none" onchange="importSave(event)">
      <button onclick="document.getElementById('importFile').click()">‚¨Ü Import Save</button>
    </div>
  </div>

  <!-- CHARACTERS -->
  <div id="characters" class="menu card">
    <h2>Pick An Anime</h2>
    <div id="seriesButtons" class="center"></div>
    <hr>
    <div id="characterList"></div>
  </div>

  <!-- WHEEL MENU -->
  <div id="wheelMenu" class="menu card center">
    <h2>Choose a Wheel</h2>
    <div id="wheelSeriesButtons" class="center"></div>
  </div>

  <!-- WHEEL -->
  <div id="wheel" class="menu card center">
    <button onclick="backToWheelMenu()">‚¨Ö Back</button>
    <h2 id="wheelTitle">Wheel</h2>
    <h1 id="hwpDisplay">0</h1>
    <button onclick="spinWheel()">Spin (50 HWP)</button>
    <div class="wheel-container">
      <div class="wheel" id="wheelResult">SPIN</div>
    </div>
    <p>Common 30% ‚Ä¢ Uncommon 10% ‚Ä¢ Rare 5% ‚Ä¢ Legendary 1%</p>
  </div>
</div>

<script>
/* ---------------- DATA ---------------- */
let selectedSeries = null;
let currentWheelSeries = null;

const defaultData = {
  hwp: 0,
  tasks: [],
  selectedCharacter: 'naruto',
  characters: {
    //Naruto
    naruto: { name:"Naruto", series:"Naruto", rarity:"Common", unlocked:true, level:1, xp:0 },
    sakura:{ name:"Sakura", series:"Naruto", rarity:"Common", unlocked:false, level:1, xp:0 },
    sasuke:{ name:"Sasuke", series:"Naruto", rarity:"Uncommon", unlocked:false, level:1, xp:0 },
    kakashi:{ name:"Kakashi", series:"Naruto", rarity:"Rare", unlocked:false, level:1, xp:0 },
    tsunade:{ name:"Tsunade", series:"Naruto", rarity:"Rare", unlocked:false, level:1, xp:0 },
    //One Piece
    luffy: { name:"Luffy", series:"One Piece", rarity:"Common", unlocked:false, level:1, xp:0 },
    nami: { name:"Nami", series:"One Piece", rarity:"Common", unlocked:false, level:1, xp:0 },
    sanji: { name:"Sanji", series:"One Piece", rarity:"Uncommon", unlocked:false, level:1, xp:0 },
    chopper: { name:"Chopper", series:"One Piece", rarity:"Rare", unlocked:false, level:1, xp:0 },
    zoro:{ name:"Zoro", series:"One Piece", rarity:"Rare", unlocked:false, level:1, xp:0 },
    enel: { name:"Enel", series:"One Piece", rarity:"Legendary", unlocked:false, level:1, xp:0 },
    //One Punch Man
    smileman: { name:"Smile Man", series:"One Punch Man", rarity:"Common", unlocked:false, level:1, xp:0 },
    fubuki: { name:"Fubuki", series:"One Punch Man", rarity:"Uncommon", unlocked:false, level:1, xp:0 },
    genos: { name:"Genos", series:"One Punch Man", rarity:"Rare", unlocked:false, level:1, xp:0 },
    saitama: { name:"Saitama", series:"One Punch Man", rarity:"Legendary", unlocked:false, level:1, xp:0 }
  }
};

let data = JSON.parse(JSON.stringify(defaultData));

/* ---------------- SAVE EXPORT / IMPORT ---------------- */
function exportSave(){
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'anime-habit-tracker-save.json';
  a.click();
  URL.revokeObjectURL(url);
}

function importSave(e){
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    try {
      const imported = JSON.parse(reader.result);
      Object.entries(imported.characters || {}).forEach(([k,c])=>{ data.characters[k] = c; });
      if(imported.tasks) data.tasks = imported.tasks;
      if(imported.hwp) data.hwp = imported.hwp;
      if(imported.selectedCharacter) data.selectedCharacter = imported.selectedCharacter;
      render();
      alert('Save imported successfully!');
    } catch {
      alert('Invalid save file');
    }
  };
  reader.readAsText(file);
}

/* ---------------- MENUS ---------------- */
function openMenu(id){
  document.querySelectorAll('.menu').forEach(m=>m.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function backToWheelMenu(){
  currentWheelSeries = null;
  openMenu('wheelMenu');
  renderWheelMenu();
}

/* ---------------- TASKS ---------------- */
function addTask(){
  const name = taskName.value.trim();
  const hwp = Number(taskHWP.value);
  if(!name || hwp<=0) return;
  data.tasks.push({ name, hwp, done:false });
  taskName.value=''; taskHWP.value='';
  render();
}

function completeTask(i){
  const t = data.tasks[i];
  if(t.done) return;
  t.done = true;
  data.hwp += t.hwp;
  gainXP(t.hwp);
  render();
}

function deleteTask(i){ data.tasks.splice(i,1); render(); }
function resetTasks(){ data.tasks=[]; render(); }

/* ---------------- XP ---------------- */
function gainXP(amount){
  const c = data.characters[data.selectedCharacter];
  if(!c || !c.unlocked) return;
  c.xp += amount;
  const need = c.level * 100;
  if(c.xp >= need){ c.xp -= need; c.level++; }
}

function selectCharacter(key){
  const c = data.characters[key];
  if(!c.unlocked) return;
  data.selectedCharacter = key;
  render();
}

/* ---------------- WHEEL ---------------- */
function spinWheel(){
  if(data.hwp < 50) return;
  data.hwp -= 50;
  const roll = Math.random()*100;

  let rarity = 'Nothing';
  if(roll <= 1) rarity = 'Legendary';
  else if(roll <= 6) rarity = 'Rare';
  else if(roll <= 16) rarity = 'Uncommon';
  else if(roll <= 46) rarity = 'Common';

  const locked = Object.entries(data.characters).filter(([k,c])=>
    !c.unlocked && c.rarity===rarity && c.series===currentWheelSeries
  );

  if(locked.length){ 
    locked[0][1].unlocked = true; 
    wheelResult.innerText = `Unlocked ${locked[0][1].name}!`; 
  }
  else wheelResult.innerText = rarity==='Nothing' ? 'Nothing üòÖ' : 'No new character';

  render();
}

/* ---------------- RENDER ---------------- */
function render(){
  hwpDisplay.innerText = data.hwp;
  taskList.innerHTML='';
  data.tasks.forEach((t,i)=>{
    const d=document.createElement('div'); d.className='task'+(t.done?' done':'');
    d.innerHTML=`<span>${t.name} (+${t.hwp})</span>
      <span>
        <button onclick="completeTask(${i})" ${t.done?'disabled':''}>Done</button>
        <button onclick="deleteTask(${i})">‚ùå</button>
      </span>`;
    taskList.appendChild(d);
  });

  characterList.innerHTML='';
  seriesButtons.innerHTML='';

  const bySeries = {};
  Object.entries(data.characters).forEach(([k,c])=>{
    if(!bySeries[c.series]) bySeries[c.series]=[];
    bySeries[c.series].push({key:k,...c});
  });

  // Series buttons sorted alphabetically
  Object.keys(bySeries).sort().forEach(series=>{
    const btn=document.createElement('button');
    btn.innerText = series;
    btn.onclick = () => { selectedSeries = series; render(); };
    seriesButtons.appendChild(btn);
  });

  if(!selectedSeries) selectedSeries=Object.keys(bySeries).sort()[0];

  const seriesDiv=document.createElement('div');
  seriesDiv.className='series';
  seriesDiv.innerHTML=`<h3>${selectedSeries}</h3>`;

  const rarityOrder = { 'Legendary': 1, 'Rare': 2, 'Uncommon': 3, 'Common': 4 };

  bySeries[selectedSeries]
    .sort((a,b)=> rarityOrder[b.rarity]-rarityOrder[a.rarity]) // sort by rarity descending
    .forEach(c=>{
      const need=c.level*100; const pct=Math.min(100,(c.xp/need)*100);
      const div=document.createElement('div');
      div.className='character'+(c.unlocked?'':' locked')+(data.selectedCharacter===c.key?' selected':'');
      div.onclick=()=>selectCharacter(c.key);
      div.innerHTML=`<strong>${c.name}</strong> (${c.rarity})<br>${c.unlocked?`Lvl ${c.level}`:'üîí Locked'}
        <div class='xp-bar'><div class='xp-fill' style='width:${pct}%'></div></div>
        <small>${c.xp}/${need} XP</small>`;
      seriesDiv.appendChild(div);
    });

  characterList.appendChild(seriesDiv);
  renderWheelMenu();
}

/* ---------------- WHEEL MENU ---------------- */
function renderWheelMenu(){
  wheelSeriesButtons.innerHTML = '';
  const seriesList = [...new Set(Object.values(data.characters).map(c=>c.series))];
  seriesList.forEach(s=>{
    const btn=document.createElement('button');
    btn.innerText = `${s} Wheel`;
    btn.onclick = () => { openWheel(s); };
    wheelSeriesButtons.appendChild(btn);
  });
}

function openWheel(series){
  currentWheelSeries = series;
  wheelTitle.innerText = `${series} Wheel`;
  wheelResult.innerText = 'SPIN';
  openMenu('wheel');
}

render();
</script>
</body>
</html>
